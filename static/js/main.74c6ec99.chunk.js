(this.webpackJsonpdenbun=this.webpackJsonpdenbun||[]).push([[0],{21:function(e,t,n){},22:function(e,t,n){},26:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n(1),o=n.n(c),r=n(13),i=n.n(r),s=(n(21),n(2)),l=(n.p,n(22),n(8)),u=n(14),d=new(window.AudioContext||window.webkitAudioContext),b=new function e(t){var a=this;Object(u.a)(this,e),this.onDecode=void 0,this.onDecode=t;var c=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;c?c.call(navigator,{audio:!0},(function(e){var t=n(23),c=n(12),o=d.createGain();d.createMediaStreamSource(e).connect(o);var r=512,i=d.createScriptProcessor(r,1,1),s=new t({sampleRate:d.sampleRate,repeatMin:6,downsampleRate:1,energyThreshold:.005,filter:function(e){return!c.Utilities.doublePeakFilter(e.energies.high,e.energies.low,1.4)}});s.on("decode",(function(e){null!=e&&a.onDecode(e)}));var u=new Float32Array(r);u.fill(0);var b=new Float32Array(r);i.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0),n=Math.floor(4);Object(l.a)(Array(n)).forEach((function(e,t){var n=128*t;n<r&&b.set(u.slice(n)),n>0&&b.set(u.slice(0,n),r-n),s.processBuffer(b)})),u.set(t)},o.connect(i),i.connect(d.destination)}),(function(e){alert("Error capturing audio.")})):alert("getUserMedia not supported in this browser.")}((function(){})),j=function(e){Object(c.useEffect)((function(){b.onDecode=e}),[e])},f=697,v=770,g=852,O=941,h=1209,p=1336,x=1477,m=1633,C={1:[f,h],2:[f,p],3:[f,x],A:[f,m],4:[v,h],5:[v,p],6:[v,x],B:[v,m],7:[g,h],8:[g,p],9:[g,x],C:[g,m],"*":[O,h],0:[O,p],"#":[O,x],D:[O,m]};function k(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1,c=d.createOscillator();c.type="sine",c.frequency.value=e;var o=d.createGain();o.gain.value=a,c.connect(o),o.connect(d.destination);var r=void 0===n?d.currentTime:n;return c.start(r),c.stop(r+t),c}function w(e,t){var n=t.duration,a=t.interval,c=t.gain,o=d.currentTime;e.split("").filter((function(e){return void 0!==C[e]})).forEach((function(e,t){!function(e,t,n){var a=k(e[0],t,n.startTime,n.gain);k(e[1],t,n.startTime,n.gain),void 0!==n.onEnd&&(a.onended=n.onEnd)}(C[e],n,{startTime:o+t*(n+a),gain:c,onEnd:function(){console.log("end sound")}})}))}var D=n(15);function y(e){return e.sort((function(t,n){return e.filter((function(e){return e===t})).length-e.filter((function(e){return e===n})).length})).pop()}function M(e,t){var n=e.indexOf("*",t+1),a=-1===n?e.slice(t+1):e.slice(t+1,n);if("*"!==e[t])return{next:n};var c=a.split("#"),o=Object(D.a)(c);return{next:n,instr:{opcode:o[0],payload:o.slice(1)}}}var F=new TextEncoder;var A=function(e){var t=Object(c.useState)(""),n=Object(s.a)(t,2),o=n[0],r=n[1],i=Object(c.useState)(""),u=Object(s.a)(i,2),d=u[0],b=u[1],j=Object(c.useState)("0.04"),f=Object(s.a)(j,2),v=f[0],g=f[1],O=Object(c.useState)("0.02"),h=Object(s.a)(O,2),p=h[0],x=h[1],m=Object(c.useCallback)((function(e){r(e.target.value)}),[r]),C=Object(c.useCallback)((function(e){b(e.target.value)}),[b]),k=Object(c.useCallback)((function(e){g(e.target.value)}),[g]),D=Object(c.useCallback)((function(e){x(e.target.value)}),[x]),y=Object(c.useCallback)((function(){console.log("encode message");var e,t=function(e){var t=e.byteLength,n="*".concat("000","#").concat(t,"#").concat(t,"#").concat(t,"\n"),a=[n,n];return a.push("*".concat("1","#0")),e.forEach((function(e){a.push("#".concat(e))})),a.push("\n*".concat("999","#0")),function(e){return e.replace(/(.)\1/g,"$1A")}(a.join(""))}(F.encode(o)),n=(e=10,Object(l.a)(Array(e)).map((function(){return"*".concat("0","#").concat("1","#").concat("1","#").concat("1","\n")})).join(""));b(n+t)}),[o,b]),M=parseFloat(v),A=parseFloat(p),S=Object(c.useCallback)((function(){console.log(d),w(d,{duration:M,interval:A,gain:.9,onFinish:function(){console.log("transmission completed")}})}),[M,A,d]);return Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("label",{htmlFor:"origMessage",children:"Original Message"}),Object(a.jsxs)("div",{children:[Object(a.jsx)("textarea",{name:"origMessage",value:o,onChange:m}),Object(a.jsx)("button",{onClick:y,children:"Encode message"})]})]}),Object(a.jsxs)("div",{children:[Object(a.jsx)("label",{htmlFor:"dtmfMessage",children:"DTMF Message"}),Object(a.jsx)("div",{children:Object(a.jsx)("textarea",{name:"dtmfMessage",value:d,onChange:C})})]}),Object(a.jsxs)("div",{children:[Object(a.jsx)("label",{htmlFor:"dtmfDuration",children:"Duration [s]"}),Object(a.jsx)("input",{type:"text",value:v,onChange:k}),Object(a.jsx)("label",{htmlFor:"dtmfInterval",children:"Interval [s]"}),Object(a.jsx)("input",{type:"text",value:p,onChange:D}),Object(a.jsx)("button",{onClick:S,children:"Send DTMF"})]})]})},S=new TextDecoder;var T=function(e){var t=Object(c.useState)(""),n=Object(s.a)(t,2),o=n[0],r=n[1],i=Object(c.useState)(""),l=Object(s.a)(i,2),u=l[0],d=l[1],b=Object(c.useCallback)((function(e){r("".concat(o).concat(e))}),[o,r]),f=Object(c.useCallback)((function(){r("")}),[r]);j(b);var v=Object(c.useCallback)((function(e){var t=function(e){var t=function(e){return e.replace(/(.)\1*/g,"$1").replace(/(.)A/g,"$1$1")}(e);console.log("dedupe",t,e);for(var n=0,a=null;-1!==n;){console.log("index",n);var c=M(t,n),o=c.instr;if(o){switch(o.opcode){case"0":var r=y(o.payload);if(console.log("announce",r),"1"!==r)return alert("Inconsistent version"),null;break;case"000":var i=y(o.payload);if(void 0===i){console.log("illformatted size operator",o.payload);break}var s=parseInt(i,10);console.log("size",s),a=new Uint8Array(s);break;case"1":var l=parseInt(o.payload[0],10),u=o.payload.slice(1).map((function(e){return parseInt(e,10)}));if(console.log("data",l,u),null===a)return console.log("missing header"),null;a.set(u,l);break;case"999":return console.log("end"),a;default:console.log("unknown instruction",o.opcode,o.payload)}n=c.next}}return a}(o);t?d(S.decode(t)):alert("Cannot interpret")}),[o,d]),g=Object(c.useCallback)((function(){d("")}),[d]);return Object(a.jsxs)("div",{className:"Decoder",children:["DTMF Decoded:",Object(a.jsx)("button",{onClick:f,children:"Clear"}),Object(a.jsx)("div",{className:"Decoder-dtmf",children:o.replaceAll("*","\n*")}),"Message Decoded:",Object(a.jsx)("button",{onClick:v,children:"Decode"}),Object(a.jsx)("button",{onClick:g,children:"Clear"}),Object(a.jsx)("div",{className:"Decoder-dtmf",children:u})]})};var E=function(){var e=Object(c.useState)(""),t=Object(s.a)(e,2),n=t[0],o=t[1],r=Object(c.useCallback)((function(e){o(n+e)}),[n,o]);return j(r),Object(a.jsxs)("div",{className:"App",children:[Object(a.jsx)("header",{className:"App-header",children:"Data transmitter via audio (under construction)"}),Object(a.jsx)(A,{}),Object(a.jsx)(T,{})]})},I=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,27)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),a(e),c(e),o(e),r(e)}))};i.a.render(Object(a.jsx)(o.a.StrictMode,{children:Object(a.jsx)(E,{})}),document.getElementById("root")),I()}},[[26,1,2]]]);
//# sourceMappingURL=main.74c6ec99.chunk.js.map