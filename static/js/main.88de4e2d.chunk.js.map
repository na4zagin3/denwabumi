{"version":3,"sources":["logo.svg","audioContext.ts","useDTMFDecoder.tsx","useDTMFEncoder.tsx","binaryDTMFCodec.ts","DTMFEncoder.tsx","DTMFDecoder.tsx","App.js","reportWebVitals.js","index.js"],"names":["window","AudioContext","webkitAudioContext","decoder","onDecode","this","getUserMedia","navigator","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","call","audio","stream","DTMF","require","Goertzel","volume","context","createGain","createMediaStreamSource","connect","bufferSize","recorder","createScriptProcessor","dtmf","sampleRate","repeatMin","downsampleRate","energyThreshold","filter","e","Utilities","doublePeakFilter","energies","on","value","console","log","previousBuffer","Float32Array","fill","windowBuffer","onaudioprocess","buffer","inputBuffer","getChannelData","count","Math","floor","Array","forEach","_","i","offset","set","slice","processBuffer","destination","alert","useDecoder","freqs","1","2","3","A","4","5","6","B","7","8","9","C","0","D","createOscillator","freq","duration","startTime","gain","oscillator","type","frequency","gainNode","time","undefined","currentTime","start","stop","sendDTMF","message","options","interval","split","c","osc1","onEnd","onended","createOscillators","mode","arr","sort","a","b","v","length","pop","parseDTMFInstruction","str","index","next","indexOf","instrStr","instr","opcode","payload","textEncoder","TextEncoder","DTMFEncoder","props","useState","origString","setOrigString","dtmfString","setDtmfString","dtmfDuration","setDtmfDuration","dtmfInterval","setDtmfInterval","onChangeOrigString","useCallback","event","target","onChangeDtmfString","onChangeDtmfDuration","onChangeDtmfInterval","onEncodeMessage","times","encoded","input","size","byteLength","iSize","strings","push","replace","dedupe","join","encodeToDTMF","encode","announcement","map","parseFloat","onStart","onFinish","htmlFor","name","onChange","onClick","textDecoder","TextDecoder","DTMFDecoder","setDtmf","decoded","setDecoded","onDTMFDecode","onDTMFClear","binary","origInput","redupe","result","version","m","parseInt","Uint8Array","bytes","s","decodeFromDTMF","decode","onClear","className","replaceAll","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.88de4e2d.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/logo.6ce24c58.svg\";","const audioContext = window.AudioContext || (window as any).webkitAudioContext;\nexport default new audioContext();\n","import {useEffect} from 'react';\nimport context from './audioContext'\n\ntype Energies = {\n    high: number[];\n    low: number[];\n}\n\ntype FilterArg = {\n    goertzel: any;\n    energies: Energies;\n}\n\nclass Decoder {\n    onDecode: (decoded: string) => void;\n\n    constructor(onDecode: (decoded: string) => void) {\n        this.onDecode = onDecode;\n\n        const success = (stream: MediaStream) => {\n            const DTMF = require('goertzeljs/lib/dtmf');\n            const Goertzel = require('goertzeljs');\n            const volume = context.createGain();\n            const audioInput = context.createMediaStreamSource(stream);\n            audioInput.connect(volume);\n            const bufferSize = 512;\n            const windowSkip = 128;\n            // TODO Rewrite this deprecated method\n            const recorder = context.createScriptProcessor(bufferSize, 1, 1);\n            const dtmf = new DTMF({\n                sampleRate: context.sampleRate,\n                repeatMin: 6,\n                downsampleRate: 1,\n                energyThreshold: 0.005,\n                filter: function(e: FilterArg){\n                    return !Goertzel.Utilities.doublePeakFilter(e.energies['high'], e.energies['low'], 1.4);\n                }\n            });\n            dtmf.on(\"decode\", (value: string) => {\n                console.log('decode', value);\n                if (value != null){\n                    this.onDecode(value);\n                }\n            });\n            const previousBuffer = new Float32Array(bufferSize);\n            previousBuffer.fill(0);\n            const windowBuffer = new Float32Array(bufferSize);\n            recorder.onaudioprocess = function(e: AudioProcessingEvent){\n                var buffer = e.inputBuffer.getChannelData(0);\n\n                const count = Math.floor(bufferSize / windowSkip);\n                [...Array(count)].forEach((_, i) => {\n                    const offset = i * windowSkip;\n                    if (offset < bufferSize) {\n                        windowBuffer.set(previousBuffer.slice(offset));\n                    }\n                    if (offset > 0) {\n                        windowBuffer.set(previousBuffer.slice(0, offset), bufferSize - offset);\n                    }\n                    dtmf.processBuffer(windowBuffer);\n                })\n\n                previousBuffer.set(buffer);\n            };\n            volume.connect (recorder);\n            recorder.connect (context.destination) ;\n        };\n\n        const getUserMedia = navigator.getUserMedia ||\n              (navigator as any).webkitGetUserMedia ||\n              (navigator as any).mozGetUserMedia ||\n              (navigator as any).msGetUserMedia;\n\n        if (getUserMedia){\n            getUserMedia.call(navigator, {audio:true}, success, function(e) {\n                alert('Error capturing audio.');\n            });\n        } else alert('getUserMedia not supported in this browser.');\n    }\n}\n\n\nconst decoder = new Decoder(() => {});\n\nconst useDecoder = (onDecode: (decoded: string) => void) => {\n\n    decoder.onDecode = onDecode\n\n};\n\nexport default useDecoder;\n","// Based on https://gitlab.com/phonelift/telesignals/-/blob/master/src/index.js\n\nimport context from './audioContext'\n\nconst freqs = {\n  // Low\n  L_697: 697.0,\n  L_770: 770.0,\n  L_852: 852.0,\n  L_941: 941.0,\n  // High\n  H_1209: 1209.0,\n  H_1336: 1336.0,\n  H_1477: 1477.0,\n  H_1633: 1633.0\n};\n\nconst dtmf: {[s: string]: [number, number]} = {\n  1: [freqs.L_697, freqs.H_1209],\n  2: [freqs.L_697, freqs.H_1336],\n  3: [freqs.L_697, freqs.H_1477],\n  A: [freqs.L_697, freqs.H_1633],\n\n  4: [freqs.L_770, freqs.H_1209],\n  5: [freqs.L_770, freqs.H_1336],\n  6: [freqs.L_770, freqs.H_1477],\n  B: [freqs.L_770, freqs.H_1633],\n\n  7: [freqs.L_852, freqs.H_1209],\n  8: [freqs.L_852, freqs.H_1336],\n  9: [freqs.L_852, freqs.H_1477],\n  C: [freqs.L_852, freqs.H_1633],\n\n  '*': [freqs.L_941, freqs.H_1209],\n  0: [freqs.L_941, freqs.H_1336],\n  '#': [freqs.L_941, freqs.H_1477],\n  D: [freqs.L_941, freqs.H_1633]\n}\n\nfunction createOscillator(freq: number, duration: number, startTime?: number, gain = 0.1) {\n    const oscillator = context.createOscillator();\n    oscillator.type = 'sine';\n    oscillator.frequency.value = freq;\n\n    const gainNode = context.createGain();\n    gainNode.gain.value = gain;\n\n    oscillator.connect(gainNode);\n    gainNode.connect(context.destination);\n\n    const time = startTime === undefined ? context.currentTime : startTime;\n    oscillator.start(time);\n    oscillator.stop(time + duration);\n\n\n    return oscillator;\n};\n\nfunction createOscillators(freqs: [number, number], duration: number, options: {startTime?: number, gain?: number, onEnd?: () => void}) {\n    const osc1 = createOscillator(freqs[0], duration, options.startTime, options.gain);\n    createOscillator(freqs[1], duration, options.startTime, options.gain);\n    if (options.onEnd !== undefined) {\n        osc1.onended = options.onEnd\n    }\n}\n\ntype Options = {\n    duration: number,\n    interval: number,\n    gain?: number,\n    onFinish?: () => void\n};\n\nexport function sendDTMF(message: string, options: Options) {\n    const {duration, interval, gain} = options\n    const currentTime = context.currentTime;\n\n    message\n        .split('')\n        .filter((c) => dtmf[c] !== undefined)\n        .forEach((c, i) => {\n            const startTime = currentTime + i * (duration + interval);\n            createOscillators(dtmf[c], duration, {\n                startTime,\n                gain,\n                onEnd: () => {\n                    console.log('end sound');\n            }});\n        })\n}\n","type DTMFInstruction = {\n    opcode: string;\n    payload: string[];\n};\n\nconst opAnnounce = \"0\";\nconst opSize = \"888\";\nconst opEnd = \"999\";\nconst opData = \"1\";\n\nconst currentVersion = \"1\";\n\nfunction dedupe(input: string) {\n    return input.replace(/(.)\\1/g, \"$1A\")\n}\n\nfunction redupe(input: string) {\n    return input\n        .replace(/(.)\\1*/g, \"$1\")\n        .replace(/(.)A/g, \"$1$1\")\n}\n\n\nexport function generateAnnouncement(times: number) {\n    const version = currentVersion;\n\n    return [...Array(times)]\n        .map(() => `*${opAnnounce}#${version}#${version}#${version}\\n`)\n        .join('');\n}\n\nexport function encodeToDTMF(input: Uint8Array) {\n    const size = input.byteLength;\n    const iSize = `*${opSize}#${size}#${size}#${size}\\n`;\n    const strings = [iSize, iSize];\n\n    strings.push(`*${opData}#0`)\n    input.forEach((b) => {\n        strings.push(`#${b}`)\n    });\n\n    strings.push(`\\n*${opEnd}#0`)\n\n    return dedupe(strings.join(''));\n}\n\nfunction mode<T>(arr: T[]){\n    return arr.sort((a,b) =>\n        arr.filter(v => v===a).length\n        - arr.filter(v => v===b).length).pop();\n}\n\nexport function decodeFromDTMF(origInput: string): Uint8Array | null {\n    const input = redupe(origInput);\n\n    let index = 0;\n    let buffer = null;\n\n    while (index !== -1) {\n\n        const result = parseDTMFInstruction(input, index);\n        const instr = result.instr;\n        if (!instr) {\n            continue;\n        }\n\n        switch (instr.opcode) {\n            case opAnnounce:\n                const version = mode(instr.payload);\n                console.log('announce', version);\n                if (version !== currentVersion) {\n                    alert('Inconsistent version');\n                    return null;\n                }\n                break;\n            case opSize:\n                const m = mode(instr.payload);\n                if (m === undefined) {\n                    console.log('illformatted size operator', instr.payload);\n                    break;\n                }\n                const size = parseInt(m, 10);\n                console.log('size', size);\n                buffer = new Uint8Array(size);\n                break;\n            case opData:\n                const offset = parseInt(instr.payload[0], 10)\n                const bytes = instr.payload.slice(1).map((s) => parseInt(s, 10));\n                console.log('data', offset, bytes);\n                if (buffer === null) {\n                    console.log('missing header');\n                    return null;\n                }\n                buffer.set(bytes, offset);\n                break;\n            case opEnd:\n                console.log('end');\n                return buffer;\n            default:\n                console.log('unknown instruction', instr.opcode, instr.payload);\n                break;\n        }\n\n        index = result.next;\n    }\n\n    return buffer;\n}\n\nfunction parseDTMFInstruction(str: string, index: number): {next: number, instr?: DTMFInstruction} {\n    const next = str.indexOf('*', index + 1);\n\n    const instrStr =\n        next === -1 ? str.slice(index + 1) : str.slice(index + 1, next);\n\n    if (str[index] !== '*') {\n        return {\n            next,\n        };\n    }\n\n    const [opcode, ...payload] = instrStr.split('#');\n\n    return {\n        next,\n        instr: {\n            opcode: opcode,\n            payload\n        }\n    };\n}\n\nfunction showDTMFInstruction(instr: DTMFInstruction) {\n\n    const header = `*${instr.opcode}`;\n    const contents =\n        instr.payload.map((s) => `${s}`).join('#');\n\n    return header + contents;\n}\n","import React, {useState, useCallback} from 'react';\nimport {sendDTMF} from './useDTMFEncoder';\nimport {generateAnnouncement, encodeToDTMF} from './binaryDTMFCodec'\n\ntype Props = {\n    \n}\n\nconst textEncoder = new TextEncoder();\n\nfunction DTMFEncoder(props: Props) {\n    const [origString, setOrigString] = useState('');\n    const [dtmfString, setDtmfString] = useState('');\n    const [dtmfDuration, setDtmfDuration] = useState('0.04');\n    const [dtmfInterval, setDtmfInterval] = useState('0.02');\n\n    const onChangeOrigString = useCallback((event) => {\n        setOrigString(event.target.value);\n    }, [setOrigString]);\n\n    const onChangeDtmfString = useCallback((event) => {\n        setDtmfString(event.target.value);\n    }, [setDtmfString]);\n\n    const onChangeDtmfDuration = useCallback((event) => {\n        setDtmfDuration(event.target.value);\n    }, [setDtmfDuration]);\n\n    const onChangeDtmfInterval = useCallback((event) => {\n        setDtmfInterval(event.target.value);\n    }, [setDtmfInterval]);\n\n    const onEncodeMessage = useCallback(() => {\n        console.log('encode message');\n        const encoded = encodeToDTMF(textEncoder.encode(origString));\n        const announcement = generateAnnouncement(10);\n        setDtmfString(announcement + encoded);\n    }, [origString, setDtmfString]);\n\n    const duration = parseFloat(dtmfDuration);\n    const interval = parseFloat(dtmfInterval);\n    const onStart = useCallback(() => {\n        console.log(dtmfString);\n        sendDTMF(dtmfString, {\n            duration,\n            interval,\n            gain: 0.9,\n            onFinish: () => {\n                console.log('transmission completed');\n            }\n        });\n    }, [duration, interval, dtmfString]);\n\n    return <div>\n\n        <div>\n            <label htmlFor=\"origMessage\">Original Message</label>\n            <div>\n                <textarea name=\"origMessage\" value={origString} onChange={onChangeOrigString} />\n                <button onClick={onEncodeMessage}>\n                    Encode message\n                </button>\n            </div>\n        </div>\n\n        <div>\n            <label htmlFor=\"dtmfMessage\">DTMF Message</label>\n            <div>\n                <textarea name=\"dtmfMessage\" value={dtmfString} onChange={onChangeDtmfString} />\n            </div>\n        </div>\n\n        <div>\n            <label htmlFor=\"dtmfDuration\">Duration [s]</label>\n            <input type=\"text\" value={dtmfDuration} onChange={onChangeDtmfDuration} />\n\n            <label htmlFor=\"dtmfInterval\">Interval [s]</label>\n            <input type=\"text\" value={dtmfInterval} onChange={onChangeDtmfInterval} />\n            <button onClick={onStart}>\n                Send DTMF\n            </button>\n        </div>\n\n    </div>;\n}\n\nexport default DTMFEncoder;\n","import React, {useState, useCallback} from 'react';\nimport useDecoder from './useDTMFDecoder';\nimport {decodeFromDTMF} from './binaryDTMFCodec'\n\n\ntype Props = {\n    \n}\n\nconst textDecoder = new TextDecoder();\n\nfunction DTMFDecoder(props: Props) {\n    const [dtmf, setDtmf] = useState('');\n    const [decoded, setDecoded] = useState('');\n\n    console.log('dtmf', dtmf);\n    const onDTMFDecode = useCallback((c) => {\n        console.log('onDTMFDecode', dtmf, c);\n        setDtmf(`${dtmf}${c}`);\n    }, [dtmf, setDtmf]);\n    const onDTMFClear = useCallback(() => {\n        setDtmf('');\n    }, [setDtmf]);\n\n    useDecoder(onDTMFDecode);\n\n    const onDecode = useCallback((c) => {\n        const binary = decodeFromDTMF(dtmf);\n        if (binary) {\n            setDecoded(textDecoder.decode(binary));\n        } else {\n            alert('Cannot interpret');\n        }\n    }, [dtmf, setDecoded]);\n    const onClear = useCallback(() => {\n        setDecoded('');\n    }, [setDecoded]);\n\n    return (<div className=\"Decoder\">\n        DTMF Decoded:\n        <button onClick={onDTMFClear}>\n            Clear\n        </button>\n        <div className=\"Decoder-dtmf\">\n            {dtmf.replaceAll('*', '\\n*')}\n        </div>\n        Message Decoded:\n        <button onClick={onDecode}>\n            Decode\n        </button>\n        <button onClick={onClear}>\n            Clear\n        </button>\n        <div className=\"Decoder-dtmf\">\n            {decoded}\n        </div>\n    </div>);\n}\n\nexport default DTMFDecoder;\n","import React, {useState, useCallback} from 'react';\nimport logo from './logo.svg';\nimport './App.css';\nimport useDecoder from './useDTMFDecoder';\nimport DTMFEncoder from './DTMFEncoder';\nimport DTMFDecoder from './DTMFDecoder';\n\nfunction App() {\n    const [decoded, setDecoded] = useState('');\n\n    const onDecode = useCallback((c) => {\n        setDecoded(decoded + c);\n    }, [decoded, setDecoded]);\n\n    useDecoder(onDecode);\n\n    return (\n        <div className=\"App\">\n          <header className=\"App-header\">\n            Data transmitter via audio (under construction)\n          </header>\n          <h2>Encoder</h2>\n          <DTMFEncoder/>\n          <h2>Decoder</h2>\n          <DTMFDecoder/>\n        </div>\n    );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}