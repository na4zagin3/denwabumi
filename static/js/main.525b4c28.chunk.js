(this.webpackJsonpdenbun=this.webpackJsonpdenbun||[]).push([[0],{21:function(e,t,n){},22:function(e,t,n){},26:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n(1),o=n.n(c),r=n(13),i=n.n(r),l=(n(21),n(2)),s=(n.p,n(22),n(8)),u=n(14),d=new(window.AudioContext||window.webkitAudioContext),b=new function e(t){var a=this;Object(u.a)(this,e),this.onDecode=void 0,this.onDecode=t;var c=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;c?c.call(navigator,{audio:!0},(function(e){var t=n(23),c=n(12),o=d.createGain();d.createMediaStreamSource(e).connect(o);var r=512,i=d.createScriptProcessor(r,1,1),l=new t({sampleRate:d.sampleRate,repeatMin:6,downsampleRate:1,energyThreshold:.005,filter:function(e){return!c.Utilities.doublePeakFilter(e.energies.high,e.energies.low,1.4)}});l.on("decode",(function(e){console.log("decode",e),null!=e&&a.onDecode(e)}));var u=new Float32Array(r);u.fill(0);var b=new Float32Array(r);i.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0),n=Math.floor(4);Object(s.a)(Array(n)).forEach((function(e,t){var n=128*t;n<r&&b.set(u.slice(n)),n>0&&b.set(u.slice(0,n),r-n),l.processBuffer(b)})),u.set(t)},o.connect(i),i.connect(d.destination)}),(function(e){alert("Error capturing audio.")})):alert("getUserMedia not supported in this browser.")}((function(){})),j=function(e){b.onDecode=e},f=697,g=770,h=852,v=941,O=1209,p=1336,m=1477,x=1633,C={1:[f,O],2:[f,p],3:[f,m],A:[f,x],4:[g,O],5:[g,p],6:[g,m],B:[g,x],7:[h,O],8:[h,p],9:[h,m],C:[h,x],"*":[v,O],0:[v,p],"#":[v,m],D:[v,x]};function k(){var e=d.createOscillator();e.type="sine";var t=d.createGain();return e.connect(t),t.connect(d.destination),[e,t]}var D=n(15);function w(e){return e.sort((function(t,n){return e.filter((function(e){return e===t})).length-e.filter((function(e){return e===n})).length})).pop()}function y(e,t){var n=e.indexOf("*",t+1),a=-1===n?e.slice(t+1):e.slice(t+1,n);if("*"!==e[t])return{next:n};var c=a.split("#"),o=Object(D.a)(c);return{next:n,instr:{opcode:o[0],payload:o.slice(1)}}}var M=new TextEncoder;var A=function(e){var t=Object(c.useState)(""),n=Object(l.a)(t,2),o=n[0],r=n[1],i=Object(c.useState)(""),u=Object(l.a)(i,2),b=u[0],j=u[1],f=Object(c.useState)("0.04"),g=Object(l.a)(f,2),h=g[0],v=g[1],O=Object(c.useState)("0.02"),p=Object(l.a)(O,2),m=p[0],x=p[1],D=Object(c.useCallback)((function(e){r(e.target.value)}),[r]),w=Object(c.useCallback)((function(e){j(e.target.value)}),[j]),y=Object(c.useCallback)((function(e){v(e.target.value)}),[v]),A=Object(c.useCallback)((function(e){x(e.target.value)}),[x]),F=Object(c.useCallback)((function(){console.log("encode message");var e,t=function(e){var t=e.byteLength,n="*".concat("888","#").concat(t,"#").concat(t,"#").concat(t,"\n"),a=[n,n];return a.push("*".concat("1","#0")),e.forEach((function(e){a.push("#".concat(e))})),a.push("\n*".concat("999","#0")),function(e){return e.replace(/(.)\1/g,"$1A").replace(/([*])\1/g,"$1$1")}(a.join(""))}(M.encode(o)),n=(e=10,Object(s.a)(Array(e)).map((function(){return"*".concat("0","#").concat("1","#").concat("1","#").concat("1","\n")})).join(""));j(n+t)}),[o,j]),T=parseFloat(h),S=parseFloat(m),E=Object(c.useCallback)((function(){console.log(b),function(e,t){var n=t.duration,a=t.interval,c=t.gain||.5,o=d.currentTime,r=k(),i=Object(l.a)(r,2),s=i[0],u=i[1],b=k(),j=Object(l.a)(b,2),f=j[0],g=j[1],h=e.split("").filter((function(e){return void 0!==C[e]}));u.gain.value=c,g.gain.value=c,h.forEach((function(e,t){var r=o+t*(n+a);s.frequency.setValueAtTime(C[e][0],r),f.frequency.setValueAtTime(C[e][1],r),u.gain.setValueAtTime(0,r),g.gain.setValueAtTime(0,r),u.gain.setValueAtTime(c,r+a),g.gain.setValueAtTime(c,r+a)})),s.start(),f.start();var v=o+h.length*(n+a);s.stop(v),f.stop(v)}(b,{duration:T,interval:S,gain:.9,onFinish:function(){console.log("transmission completed")}})}),[T,S,b]);return Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("label",{htmlFor:"origMessage",children:"Original Message"}),Object(a.jsxs)("div",{children:[Object(a.jsx)("textarea",{name:"origMessage",value:o,onChange:D}),Object(a.jsx)("button",{onClick:F,children:"Encode message"})]})]}),Object(a.jsxs)("div",{children:[Object(a.jsx)("label",{htmlFor:"dtmfMessage",children:"DTMF Message"}),Object(a.jsx)("div",{children:Object(a.jsx)("textarea",{name:"dtmfMessage",value:b,onChange:w})})]}),Object(a.jsxs)("div",{children:[Object(a.jsx)("label",{htmlFor:"dtmfDuration",children:"Duration [s]"}),Object(a.jsx)("input",{type:"text",value:h,onChange:y}),Object(a.jsx)("label",{htmlFor:"dtmfInterval",children:"Interval [s]"}),Object(a.jsx)("input",{type:"text",value:m,onChange:A}),Object(a.jsx)("button",{onClick:E,children:"Send DTMF"})]})]})},F=new TextDecoder;var T=function(e){var t=Object(c.useState)(""),n=Object(l.a)(t,2),o=n[0],r=n[1],i=Object(c.useState)(""),s=Object(l.a)(i,2),u=s[0],d=s[1];console.log("dtmf",o);var b=Object(c.useCallback)((function(e){console.log("onDTMFDecode",o,e),r("".concat(o).concat(e))}),[o,r]),f=Object(c.useCallback)((function(){r("")}),[r]);j(b);var g=Object(c.useCallback)((function(e){var t=function(e){for(var t=function(e){return e.replace(/(.)\1*/g,"$1").replace(/(.)A/g,"$1$1")}(e),n=0,a=null;-1!==n;){var c=y(t,n),o=c.instr;if(o){switch(o.opcode){case"0":var r=w(o.payload);if(console.log("announce",r),"1"!==r)return alert("Inconsistent version"),null;break;case"888":var i=w(o.payload);if(void 0===i){console.log("illformatted size operator",o.payload);break}var l=parseInt(i,10);console.log("size",l),a=new Uint8Array(l);break;case"1":var s=parseInt(o.payload[0],10),u=o.payload.slice(1).map((function(e){return parseInt(e,10)}));if(console.log("data",s,u),null===a)return console.log("missing header"),null;s>a.length?console.log("invalid offset",{offset:s,fragment:u.length,buffer:a.length}):s+u.length>a.length?(console.log("too long fragment",{offset:s,fragment:u.length,buffer:a.length}),a.set(u.slice(0,a.length-s),s)):a.set(u,s);break;case"999":return console.log("end"),a;default:console.log("unknown instruction",o.opcode,o.payload)}n=c.next}}return a}(o);t?d(F.decode(t)):alert("Cannot interpret")}),[o,d]),h=Object(c.useCallback)((function(){d("")}),[d]);return Object(a.jsxs)("div",{className:"Decoder",children:["DTMF Decoded:",Object(a.jsx)("button",{onClick:f,children:"Clear"}),Object(a.jsx)("div",{className:"Decoder-dtmf",children:o.replaceAll("*","\n*")}),"Message Decoded:",Object(a.jsx)("button",{onClick:g,children:"Decode"}),Object(a.jsx)("button",{onClick:h,children:"Clear"}),Object(a.jsx)("div",{className:"Decoder-dtmf",children:u})]})};var S=function(){var e=Object(c.useState)(""),t=Object(l.a)(e,2),n=t[0],o=t[1],r=Object(c.useCallback)((function(e){o(n+e)}),[n,o]);return j(r),Object(a.jsxs)("div",{className:"App",children:[Object(a.jsx)("header",{className:"App-header",children:"Data transmitter via audio (under construction)"}),Object(a.jsx)("h2",{children:"Encoder"}),Object(a.jsx)(A,{}),Object(a.jsx)("h2",{children:"Decoder"}),Object(a.jsx)(T,{})]})},E=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,27)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,o=t.getLCP,r=t.getTTFB;n(e),a(e),c(e),o(e),r(e)}))};i.a.render(Object(a.jsx)(o.a.StrictMode,{children:Object(a.jsx)(S,{})}),document.getElementById("root")),E()}},[[26,1,2]]]);
//# sourceMappingURL=main.525b4c28.chunk.js.map