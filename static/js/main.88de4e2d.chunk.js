(this.webpackJsonpdenbun=this.webpackJsonpdenbun||[]).push([[0],{21:function(e,n,t){},22:function(e,n,t){},26:function(e,n,t){"use strict";t.r(n);var a=t(0),c=t(1),o=t.n(c),r=t(13),i=t.n(r),s=(t(21),t(2)),l=(t.p,t(22),t(8)),u=t(14),d=new(window.AudioContext||window.webkitAudioContext),b=new function e(n){var a=this;Object(u.a)(this,e),this.onDecode=void 0,this.onDecode=n;var c=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;c?c.call(navigator,{audio:!0},(function(e){var n=t(23),c=t(12),o=d.createGain();d.createMediaStreamSource(e).connect(o);var r=512,i=d.createScriptProcessor(r,1,1),s=new n({sampleRate:d.sampleRate,repeatMin:6,downsampleRate:1,energyThreshold:.005,filter:function(e){return!c.Utilities.doublePeakFilter(e.energies.high,e.energies.low,1.4)}});s.on("decode",(function(e){console.log("decode",e),null!=e&&a.onDecode(e)}));var u=new Float32Array(r);u.fill(0);var b=new Float32Array(r);i.onaudioprocess=function(e){var n=e.inputBuffer.getChannelData(0),t=Math.floor(4);Object(l.a)(Array(t)).forEach((function(e,n){var t=128*n;t<r&&b.set(u.slice(t)),t>0&&b.set(u.slice(0,t),r-t),s.processBuffer(b)})),u.set(n)},o.connect(i),i.connect(d.destination)}),(function(e){alert("Error capturing audio.")})):alert("getUserMedia not supported in this browser.")}((function(){})),j=function(e){b.onDecode=e},f=697,v=770,g=852,h=941,O=1209,p=1336,x=1477,m=1633,C={1:[f,O],2:[f,p],3:[f,x],A:[f,m],4:[v,O],5:[v,p],6:[v,x],B:[v,m],7:[g,O],8:[g,p],9:[g,x],C:[g,m],"*":[h,O],0:[h,p],"#":[h,x],D:[h,m]};function k(e,n,t){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1,c=d.createOscillator();c.type="sine",c.frequency.value=e;var o=d.createGain();o.gain.value=a,c.connect(o),o.connect(d.destination);var r=void 0===t?d.currentTime:t;return c.start(r),c.stop(r+n),c}function D(e,n){var t=n.duration,a=n.interval,c=n.gain,o=d.currentTime;e.split("").filter((function(e){return void 0!==C[e]})).forEach((function(e,n){!function(e,n,t){var a=k(e[0],n,t.startTime,t.gain);k(e[1],n,t.startTime,t.gain),void 0!==t.onEnd&&(a.onended=t.onEnd)}(C[e],t,{startTime:o+n*(t+a),gain:c,onEnd:function(){console.log("end sound")}})}))}var w=t(15);function M(e){return e.sort((function(n,t){return e.filter((function(e){return e===n})).length-e.filter((function(e){return e===t})).length})).pop()}function y(e,n){var t=e.indexOf("*",n+1),a=-1===t?e.slice(n+1):e.slice(n+1,t);if("*"!==e[n])return{next:t};var c=a.split("#"),o=Object(w.a)(c);return{next:t,instr:{opcode:o[0],payload:o.slice(1)}}}var F=new TextEncoder;var T=function(e){var n=Object(c.useState)(""),t=Object(s.a)(n,2),o=t[0],r=t[1],i=Object(c.useState)(""),u=Object(s.a)(i,2),d=u[0],b=u[1],j=Object(c.useState)("0.04"),f=Object(s.a)(j,2),v=f[0],g=f[1],h=Object(c.useState)("0.02"),O=Object(s.a)(h,2),p=O[0],x=O[1],m=Object(c.useCallback)((function(e){r(e.target.value)}),[r]),C=Object(c.useCallback)((function(e){b(e.target.value)}),[b]),k=Object(c.useCallback)((function(e){g(e.target.value)}),[g]),w=Object(c.useCallback)((function(e){x(e.target.value)}),[x]),M=Object(c.useCallback)((function(){console.log("encode message");var e,n=function(e){var n=e.byteLength,t="*".concat("888","#").concat(n,"#").concat(n,"#").concat(n,"\n"),a=[t,t];return a.push("*".concat("1","#0")),e.forEach((function(e){a.push("#".concat(e))})),a.push("\n*".concat("999","#0")),function(e){return e.replace(/(.)\1/g,"$1A")}(a.join(""))}(F.encode(o)),t=(e=10,Object(l.a)(Array(e)).map((function(){return"*".concat("0","#").concat("1","#").concat("1","#").concat("1","\n")})).join(""));b(t+n)}),[o,b]),y=parseFloat(v),T=parseFloat(p),A=Object(c.useCallback)((function(){console.log(d),D(d,{duration:y,interval:T,gain:.9,onFinish:function(){console.log("transmission completed")}})}),[y,T,d]);return Object(a.jsxs)("div",{children:[Object(a.jsxs)("div",{children:[Object(a.jsx)("label",{htmlFor:"origMessage",children:"Original Message"}),Object(a.jsxs)("div",{children:[Object(a.jsx)("textarea",{name:"origMessage",value:o,onChange:m}),Object(a.jsx)("button",{onClick:M,children:"Encode message"})]})]}),Object(a.jsxs)("div",{children:[Object(a.jsx)("label",{htmlFor:"dtmfMessage",children:"DTMF Message"}),Object(a.jsx)("div",{children:Object(a.jsx)("textarea",{name:"dtmfMessage",value:d,onChange:C})})]}),Object(a.jsxs)("div",{children:[Object(a.jsx)("label",{htmlFor:"dtmfDuration",children:"Duration [s]"}),Object(a.jsx)("input",{type:"text",value:v,onChange:k}),Object(a.jsx)("label",{htmlFor:"dtmfInterval",children:"Interval [s]"}),Object(a.jsx)("input",{type:"text",value:p,onChange:w}),Object(a.jsx)("button",{onClick:A,children:"Send DTMF"})]})]})},A=new TextDecoder;var S=function(e){var n=Object(c.useState)(""),t=Object(s.a)(n,2),o=t[0],r=t[1],i=Object(c.useState)(""),l=Object(s.a)(i,2),u=l[0],d=l[1];console.log("dtmf",o);var b=Object(c.useCallback)((function(e){console.log("onDTMFDecode",o,e),r("".concat(o).concat(e))}),[o,r]),f=Object(c.useCallback)((function(){r("")}),[r]);j(b);var v=Object(c.useCallback)((function(e){var n=function(e){for(var n=function(e){return e.replace(/(.)\1*/g,"$1").replace(/(.)A/g,"$1$1")}(e),t=0,a=null;-1!==t;){var c=y(n,t),o=c.instr;if(o){switch(o.opcode){case"0":var r=M(o.payload);if(console.log("announce",r),"1"!==r)return alert("Inconsistent version"),null;break;case"888":var i=M(o.payload);if(void 0===i){console.log("illformatted size operator",o.payload);break}var s=parseInt(i,10);console.log("size",s),a=new Uint8Array(s);break;case"1":var l=parseInt(o.payload[0],10),u=o.payload.slice(1).map((function(e){return parseInt(e,10)}));if(console.log("data",l,u),null===a)return console.log("missing header"),null;a.set(u,l);break;case"999":return console.log("end"),a;default:console.log("unknown instruction",o.opcode,o.payload)}t=c.next}}return a}(o);n?d(A.decode(n)):alert("Cannot interpret")}),[o,d]),g=Object(c.useCallback)((function(){d("")}),[d]);return Object(a.jsxs)("div",{className:"Decoder",children:["DTMF Decoded:",Object(a.jsx)("button",{onClick:f,children:"Clear"}),Object(a.jsx)("div",{className:"Decoder-dtmf",children:o.replaceAll("*","\n*")}),"Message Decoded:",Object(a.jsx)("button",{onClick:v,children:"Decode"}),Object(a.jsx)("button",{onClick:g,children:"Clear"}),Object(a.jsx)("div",{className:"Decoder-dtmf",children:u})]})};var E=function(){var e=Object(c.useState)(""),n=Object(s.a)(e,2),t=n[0],o=n[1],r=Object(c.useCallback)((function(e){o(t+e)}),[t,o]);return j(r),Object(a.jsxs)("div",{className:"App",children:[Object(a.jsx)("header",{className:"App-header",children:"Data transmitter via audio (under construction)"}),Object(a.jsx)("h2",{children:"Encoder"}),Object(a.jsx)(T,{}),Object(a.jsx)("h2",{children:"Decoder"}),Object(a.jsx)(S,{})]})},I=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,27)).then((function(n){var t=n.getCLS,a=n.getFID,c=n.getFCP,o=n.getLCP,r=n.getTTFB;t(e),a(e),c(e),o(e),r(e)}))};i.a.render(Object(a.jsx)(o.a.StrictMode,{children:Object(a.jsx)(E,{})}),document.getElementById("root")),I()}},[[26,1,2]]]);
//# sourceMappingURL=main.88de4e2d.chunk.js.map